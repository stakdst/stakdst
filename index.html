<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>英単語4択クイズ (English→日本語)</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; padding: 20px; background:#fafafa; color:#111; }
.container { max-width: 900px; margin: 0 auto; background:white; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.06); border-radius:8px; }
h1 { margin-top:0; }
.controls { margin-bottom: 18px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
.word { font-size: 2rem; margin: 16px 0; }
.choices { display:flex; flex-direction:column; gap:8px; margin-bottom:12px; }
.choiceBtn { padding:10px; font-size:1rem; cursor:pointer; border:1px solid #ddd; background:#fff; border-radius:6px; text-align:left; transition:background 0.3s; }
.choiceBtn:hover { box-shadow:0 1px 4px rgba(0,0,0,0.06); }
.correct { background:#ff9999 !important; } /* 赤 */
.wrong { background:#99ccff !important; }  /* 青 */
.progress { font-weight:600; }
.timer { font-size:1.2rem; font-weight:bold; margin:10px 0; }
select, input, button { font-size:1rem; padding:4px; }
</style>
</head>
<body>
<div class="container">
  <h1>英単語4択クイズ</h1>

  <div class="controls" id="controls">
    <label>範囲: <input id="rangeStart" type="number" min="1" value="1" style="width:70px"> 〜 
      <input id="rangeEnd" type="number" min="1" value="200" style="width:70px"></label>
    <label>制限時間:
      <select id="timeSelect"></select> 秒
    </label>
    <button id="startBtn">スタート</button>
  </div>

  <div id="quizArea" class="hidden">
    <div class="progress" id="progress">0 / 0</div>
    <div id="globalTimer" class="timer"></div>
    <div id="englishWord" class="word"></div>
    <div id="choices" class="choices"></div>
  </div>

  <div id="summary" class="hidden"></div>
</div>

<script>
/* ===== サンプル200語 ===== */
const sampleWords = [];
for (let i=1;i<=200;i++){
  sampleWords.push({english:`word${i}`, japanese:`単語${i}`});
}

let wordPairs = sampleWords;
let quizList = [];
let currentIndex = 0;
let score = 0;
let globalTime = 0;
let globalTimerInterval = null;

// DOM
const startBtn = document.getElementById('startBtn');
const rangeStart = document.getElementById('rangeStart');
const rangeEnd = document.getElementById('rangeEnd');
const quizArea = document.getElementById('quizArea');
const englishWordDiv = document.getElementById('englishWord');
const choicesDiv = document.getElementById('choices');
const progressDiv = document.getElementById('progress');
const summaryDiv = document.getElementById('summary');
const globalTimerDiv = document.getElementById('globalTimer');
const timeSelect = document.getElementById('timeSelect');
const controls = document.getElementById('controls');

// ===== 制限時間セレクトを作成 (50〜2100秒, 50刻み) =====
for (let t=50; t<=2100; t+=50){
  let opt=document.createElement("option");
  opt.value=t; opt.textContent=t;
  timeSelect.appendChild(opt);
}
timeSelect.value=200; // 初期値

startBtn.addEventListener('click', () => {
  const start = parseInt(rangeStart.value)||1;
  const end = parseInt(rangeEnd.value)||wordPairs.length;

  if (start<1 || end>wordPairs.length || start>=end){
    alert("範囲指定が不正です");
    return;
  }
  const selected = wordPairs.slice(start-1,end);
  quizList = [...selected];
  quizList.sort(()=>Math.random()-0.5);

  globalTime = parseInt(timeSelect.value);

  score=0; currentIndex=0;
  quizArea.classList.remove('hidden');
  summaryDiv.classList.add('hidden');

  // コントロールを無効化
  Array.from(controls.querySelectorAll("input,select,button")).forEach(el=>el.disabled=true);

  startGlobalTimer();
  showQuestion();
});

function startGlobalTimer(){
  clearInterval(globalTimerInterval);
  updateGlobalTimer();
  globalTimerInterval = setInterval(()=>{
    globalTime--;
    updateGlobalTimer();
    if (globalTime<=0){
      clearInterval(globalTimerInterval);
      showSummary(true);
    }
  },1000);
}

function updateGlobalTimer(){
  globalTimerDiv.textContent = `残り時間: ${globalTime}秒`;
}

function showQuestion(){
  if (currentIndex >= quizList.length){
    return showSummary();
  }
  const item = quizList[currentIndex];
  progressDiv.textContent = `${currentIndex+1} / ${quizList.length}`;
  englishWordDiv.textContent = item.english;

  const correct = item.japanese;
  const pool = [...wordPairs.map(w=>w.japanese)];
  const wrongs = [];
  while (wrongs.length<3){
    const c = pool[Math.floor(Math.random()*pool.length)];
    if (c!==correct && !wrongs.includes(c)) wrongs.push(c);
  }
  const choices = [correct,...wrongs].sort(()=>Math.random()-0.5);

  choicesDiv.innerHTML = "";
  choices.forEach(ch=>{
    const btn=document.createElement("button");
    btn.className="choiceBtn";
    btn.textContent=ch;

    // ★ 押した瞬間に判定
    btn.addEventListener("mousedown", ()=>selectChoice(btn,ch,correct));
    btn.addEventListener("touchstart", (e)=>{
      e.preventDefault(); // touchend の二重発火防止
      selectChoice(btn,ch,correct);
    }, {passive:false});

    choicesDiv.appendChild(btn);
  });
}

function selectChoice(btn,selected,correct){
  const buttons=document.querySelectorAll(".choiceBtn");
  buttons.forEach(b=>b.disabled=true);

  if (selected===correct){
    btn.classList.add("correct");
    score++;
  }else{
    buttons.forEach(b=>{
      if (b.textContent===correct){
        b.classList.add("correct");
      }else{
        b.classList.add("wrong");
      }
    });
    quizList.push(quizList[currentIndex]); // 後ろに回す
  }
  setTimeout(()=>{ currentIndex++; showQuestion(); },500);
}

function showSummary(timeout=false){
  clearInterval(globalTimerInterval);
  quizArea.classList.add('hidden');
  summaryDiv.classList.remove('hidden');
  summaryDiv.innerHTML=`<h2>結果</h2>
  <p>${timeout?"時間切れ！ ":""}正答数: ${score} / ${quizList.length}</p>`;
}
</script>
</body>
</html>
